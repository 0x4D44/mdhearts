# mdhearts: 2025 Rust Remaster Design

**Document Date:** 24 September 2025

## 1. Executive Summary
We are building mdhearts, a modern Windows-native revival of the classic Microsoft Hearts experience that runs locally, supports up to four seats with advanced AI opponents, and provides a polished single-player experience faithful to the classic Windows releases. The initial milestone targets a Rust codebase using the `windows` crate (windows-rs) for Win32/WinUI integration, drawing UI and systems inspiration from the open-source Solitaire project at https://github.com/0x4D44/mdsol. Networking and live services are intentionally out of scope for the first release and will be considered once the offline foundation is mature.

## 2. Scope & Product Goals
1. **Faithful Core Gameplay:** Implement standard Hearts (Black Lady) rules with configurable variants (optional Jack of Diamonds bonus, no-pass rounds) while maintaining the feel of the original Windows titles.
2. **Modern Windows Presentation:** Deliver a responsive WinUI-style interface, crisp vector card rendering, subtle animations, and audio cues that resonate with the nostalgia of older versions without feeling dated.
3. **Personality-Driven AI:** Ship with multiple AI difficulty levels and persona quirks that emulate the classic "states" opponents while providing more adaptive play.
4. **Quality-of-Life & Accessibility:** Provide undo/redo in tutorials, color-blind friendly palettes, full keyboard support, narration hooks, and scalable text to accommodate a broad Windows audience.
5. **Extensible Architecture:** Structure the codebase so that adding online multiplayer, achievements, or telemetry in future iterations is straightforward without re-architecting the core.

## 3. Legacy Insights
- **Classic Loop:** Windows Hearts popularized the four-player Black Lady ruleset with passing, trick-taking, 100-point end conditions, and the dramatic "shoot the moon" mechanic, executed via simple menu-driven options and stat tracking.
- **User Experience:** Windows Vista/7 introduced an Oberon Media rewrite with selectable decks, table backgrounds, and persistent stats; these elements remain valuable references for visual customization, pacing, and charm.
- **Technology Constraints:** Earlier networking relied on NetDDE (Windows for Workgroups), which was deprecated; our Rust design avoids legacy dependencies while leaving a path for secure future networking.

## 4. Platform & Technology Strategy
- **Primary Target:** Windows 11 desktop (x64) with support for Windows 10 22H2.
- **Language:** Rust 1.81+ leveraging the `windows` crate for COM/Win32 APIs and WinUI 3 interop.
- **UI Framework:** WinUI 3 via Windows App SDK, wrapped with Rust bindings (`windows` + `microsoft.ui.xaml` projections) and MVVM-style state management.
- **Rendering:** Adopt card rendering utilities and asset pipeline patterns from `mdsol`, repurposing sprite sheets or vector definitions; use Direct2D/DirectWrite for high-DPI friendly drawing.
- **Audio:** XAudio2 bindings through windows-rs for lightweight sound effects.
- **Persistence:** Local JSON/SQLite store managed through Rust (`serde`, `rusqlite`) for player profiles, statistics, and settings.

## 5. Gameplay & UX Experience
- **Table Layout:** Central table view with three AI opponents positioned around the user. Supports portrait-equivalent compact mode for snapped windows and full landscape layout.
- **Input:** Mouse drag-and-drop, click-to-select/click-to-play, and keyboard shortcuts (arrow navigation + Enter). Controller input is optional future work.
- **Tutorials:** Guided onboarding that introduces passing, trick strategy, and shoot-the-moon scenarios. Includes optional hints and step-by-step overlays.
- **Customization:** Choose deck backs, table themes, and background music sets derived from mdsol asset inspirations. Save presets per player profile.
- **Feedback:** Trick animations, score popups, moon-shoot celebration, undo (tutorial only), and per-hand recap modal.

## 6. Systems Design
- **Rules Engine:** Deterministic turn resolver that enforces passing order (left, right, across, hold), lead suit constraints, scoring, moon handling, and tie-breaking. Implemented as pure Rust logic with unit test coverage.
- **AI Personas:** Strategy modules parameterized by aggression, memorandum depth, risk of shooting the moon, and passing heuristics. Provide at least three personas (Conservative, Balanced, Aggressive) plus a "Classic" mode mimicking legacy heuristics.
- **State Management:** Central game state struct backed by immutable snapshots for undo/redo within tutorials; serialization for saving mid-hand and post-hand statistics.
- **Statistics:** Per-profile storage of games played, win rate, moon attempts/success, average points per hand, and longest streaks. Display as charts/tables in a stats view.

## 7. Technical Architecture
- **Rust Crates:**
  - `hearts-core`: Rules engine, AI, serialization models, shared enums.
  - `hearts-ui`: WinUI view models, command bindings, resource loading, localization helpers.
  - `hearts-app`: Desktop entry point, window lifecycle, settings management, data persistence bridge.
- **Interop Layer:** Encapsulate windows-rs generated bindings in a `platform` module to isolate raw Win32/WinUI calls and ease potential porting.
- **Asset Pipeline:** Adapt mdsol build scripts for card assets, converting to WinUI-compatible resources (e.g., encoded PNG/Vector). Provide automated verification of suit/face mappings.
- **Testing:** Use `cargo test` for logic crates, UI smoke tests via WinAppDriver or UITest (optional). Continuous integration with GitHub Actions targeting `x86_64-pc-windows-msvc`.

## 8. Accessibility & Localization
- Text scaling from 80% to 200%, persisted per profile.
- High-contrast and color-blind decks (Daltonic-friendly patterns) leveraging mdsol card design variations.
- Screen-reader labels for cards (ranks, suits, leading player) via UI Automation properties.
- Keyboard navigation for all menus/dialogs; focus indicators and shortcut hints.
- Initial localization for English only, with resource abstraction enabling future translations.

## 9. Audio & Visual Identity
- Subtle card slide sounds, trick collection sweep, moon-shoot sting.
- Ambient table hum loop (toggle-able).
- Modern take on classic Windows green felt, plus optional "Aero" and "Pixel" throwback themes.
- Animations limited to 120ms micro-transitions to keep interactions snappy while adding polish.

## 10. Persistence, Settings & Telemetry
- Store settings and stats locally under `%LOCALAPPDATA%/mdhearts/`.
- Settings include difficulty, theme, audio levels, and house rules toggles.
- Telemetry limited to local opt-in logs for debugging; no external data transmission in initial release.

## 11. Development Roadmap (High Level)
1. **Foundation:** Stand up Rust workspace, integrate windows-rs, and import mdsol assets.
2. **Core Gameplay:** Build rules engine, card rendering, and pass/trick flows.
3. **AI & Tutorials:** Implement persona behaviors, hints, and guided missions.
4. **UX Polish & Accessibility:** Finalize themes, animations, and accessibility budget.
5. **Stability & Packaging:** Harden persistence, complete QA, and ship MSIX installer.
6. **Future Extension:** Evaluate requirements for networked multiplayer post-launch.

## 12. Risks & Mitigations
- **WinUI + Rust Integration Complexity:** Mitigate by leveraging `windows` crate projections and encapsulating unsafe code in a thin platform layer with targeted integration tests.
- **Asset Adaptation from mdsol:** Confirm licensing compatibility, automate build scripts to validate sprite alignment, and adjust vector scaling for high DPI.
- **AI Quality Perception:** Conduct playtesting loops with telemetry logging to refine heuristics; provide difficulty disclaimers and sliders.
- **Performance on Older Hardware:** Profile with PIX and Windows Performance Analyzer; offer settings to disable animations and reduce effects.

## 13. Future Opportunities
- Add online multiplayer using Azure PlayFab Relay or WebRTC once the offline loop is proven.
- Introduce daily challenges, achievements, and cross-device cloud saves.
- Expand localization and controller/Steam Deck support.

## 14. References
1. "Microsoft Hearts" — Wikipedia (retrieved 24 September 2025).
2. "Hearts" — BetaWiki (accessed 24 September 2025).
3. Microsoft, "MS04-031: Windows NetDDE Remote Code Execution" Security Bulletin (12 October 2004).
4. Jon Fingas, "Microsoft is shutting down its internet board and card games," Engadget (14 July 2019).
5. 0x4D44, "mdsol" Solitaire codebase (GitHub, accessed 24 September 2025).
