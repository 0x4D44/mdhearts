Title: Stage 3 (Hard) – Polish, Guardrails, and Test Expansion

Context
- Stage 2 is wrapped (moon/void/follow-ups/endgame/logging/weights) with goldens.
- Stage 3 (Hard) is implemented with 1‑ply current‑trick rollout and next‑trick probe branching on first opponent under caps; CLI/benches in place.
- We now need to harden Hard, improve explainability, and expand tests/bench guardrails without destabilizing Normal.

Goals (next 1–3 days)
- Stability: Hard remains opt‑in and deterministic; Normal behavior unchanged and goldens stable.
- Performance: Hard decisions typically < 20–30ms with strict caps; no long tails.
- Explainability: Console explain in Hard can show base/cont/total when requested; JSON export already verbose.
- Quality: Add targeted goldens covering Hard vs Normal disagreements and edge scenarios.

Workstreams

1) Hard Search Engine – Branching & Pruning
- Extend next‑trick probe to selectively branch on the second opponent when time permits.
  - Add small loop after first reply; reuse void‑aware follow‑up policy; respect `MDH_HARD_TIME_CAP_MS`.
- Add early cutoff in 1‑ply rollout loop: stop scanning candidates when totals are clearly dominated (tiny window).
- Knobs: ensure `MDH_HARD_BRANCH_LIMIT`, `MDH_HARD_NEXT_BRANCH_LIMIT`, `MDH_HARD_TIME_CAP_MS` honored across all loops.
- Acceptance: New tests pass; benches show no tail regressions.

2) Planner‑Level Targeting Nudge (Normal + Hard)
- In `play.rs::base_score`, add a small positive when a non‑capturing play tends to keep the current provisional winner equal to the scoreboard leader and penalties>0.
- Guard with scoreboard gap and ≥90 logic to avoid over‑feeding.
- Acceptance: Existing goldens stable; add/adjust one leader‑target golden if scoring change is intended.

3) Moon Heuristics Tuning
- Refine commit/abort thresholds using decision logs: include “control continuity” (consecutive winning capability) and hearts distribution.
- Add clearer transition logs in `update_moon_states_after_trick` (retain MDH_DEBUG_LOGS gating).
- Tests: scenarios where abort triggers after opponents start collecting hearts mid‑run.

4) Explain UX for Hard (Console)
- In `cli.rs --explain-once/batch`, optionally print per‑candidate base/cont/total breakdown when difficulty=hard and `MDH_DEBUG_LOGS=1`.
- Keep default concise; add `--verbose` flag in CLI for unconditional breakdown (optional).
- Acceptance: human‑readable explain with Hard stats; JSON path unchanged.

5) Goldens and Disagreement Tests
- Use `--compare-batch` to find real disagreements; capture 2–3 stable seeds (per seat) where Hard improves margin.
- Add tests:
  - `hard_vs_normal_disagreement.rs`: asserts different top for known seed.
  - Multi‑void follow‑up cases ensuring we don’t self‑feed and leader targeting remains correct.
  - Tight endgame near 90–100 with score‑gap awareness.

6) Performance Benches & Guardrails
- Extend benches:
  - `heuristic_decision`: broaden card‑heavy scenarios; record baseline in journal.
  - `hard_decision`: measure scanned/elapsed under varying branch limits; add a perf test asserting elapsed ≤ cap + small epsilon.
- Optional: add CI‑guarded perf test behind feature flag to avoid flaky environments.

7) Docs & Tuning Aids
- README: ensure Hard knobs documented; add quick examples for `--explain-json`, `--compare-batch` workflows.
- Tuning: update designs/tuning with a seeds list and example CSV from compare‑batch.

Milestones
- M1 (today): Land console verbose explain for Hard; add first disagreement golden; update journal with compare‑batch runs.
- M2 (tomorrow): Add second‑opponent branching and early cutoff; update benches and record stats.
- M3 (next): Moon tuning + additional goldens; finalize README updates and close Stage 3 polish.

Validation Checklist
- Cargo tests green (core/app); new goldens deterministic on local toolchain.
- Normal goldens unchanged unless intentionally improved; call out any changes.
- Benches: Normal unchanged order of magnitude; Hard within caps; journal updated with numbers.

