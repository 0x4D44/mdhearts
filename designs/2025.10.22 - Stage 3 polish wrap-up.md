Stage 3 (Hard) — Polish Wrap-up

What shipped
- Hard planner (Stage 3 scaffold) with:
  - Deterministic Budget (env-gated) for step-capped scans.
  - Phase‑B top‑K continuation (env-gated, base-only beyond K).
  - Continuation signals (tiny): current‑trick feed/self‑capture, next‑trick start bonus.
  - Tie‑break (env‑gated): multiplicative boost to continuation under small base gaps.
  - Deterministic reply sampling/branching infrastructure available via knobs (kept conservative).
- CLI & tooling:
  - Hard flags passed via CLI (no env needed).
  - Weights/knobs surfaced (show‑weights + per‑command hard‑flags summary).
  - Deterministic explain/compare; JSON export; bench‑check (quick perf micro‑gauge).
- Tests & goldens:
  - Exact flip goldens (deterministic): 2031/E, 1145/N, 1080/S, 1040/W.
  - Constructed: mid‑trick continuation preference; endgame self‑protect; leader dump QS; avoid feeding non‑leader.
  - Deterministic disagreement goldens (inequality) and CSVs saved under designs/tuning/.
- Docs:
  - CLI tools updated with Hard flags; Tuning Quickstart; Seeds Index; Perf snapshot.

Knobs (quick list)
- Difficulty: MDH_BOT_DIFFICULTY=easy|normal|hard (or CLI difficulty param)
- Hard search:
  - MDH_HARD_DETERMINISTIC, MDH_HARD_TEST_STEPS
  - MDH_HARD_BRANCH_LIMIT, MDH_HARD_NEXT_BRANCH_LIMIT, MDH_HARD_TIME_CAP_MS, MDH_HARD_EARLY_CUTOFF_MARGIN
  - MDH_HARD_PHASEB_TOPK
  - MDH_HARD_CONT_BOOST_GAP, MDH_HARD_CONT_BOOST_FACTOR
- Normal heuristic weights: MDH_W_* (see README)

Perf (current snapshot)
- Normal p95: ~0.11–0.16 ms across seats.
- Hard p95 (deterministic, steps=80): ~1.55–2.49 ms across seats.
- Guardrail guidance: keep typical < 20–30 ms if widening caps.

Validation artifacts
- designs/tuning/compare_* CSVs (deterministic, only disagreements).
- designs/perf/2025-10-22 - Bench Snapshot.md.

Open items / future work
- Tuning: iterate tiny continuation weights with disagreement CSVs; expand stable goldens as behavior improves.
- Adaptive limits: refine thresholds; keep off by default unless perf & outcomes clearly benefit.
- Explain UX: optional inline continuation parts for console by flag (JSON already includes verbose candidates).
- Perf guardrails: optional CI warn thresholds for bench‑check’s p95 under wider caps.
- (Stretch) Depth: selective probed reply for third/fourth players under strict budgets.

