Stage 4 (Hard++) — Roadmap

Objectives
- Increase tactical depth beyond current-trick + next-trick probe while preserving responsiveness and determinism when desired.
- Integrate richer opponent modeling (voids, penalty tendencies) and better pruning/ordering.
- Maintain compatibility with Normal planner heuristics and existing goldens.

Scope (incremental milestones)
M1) Search Engine Core
- Shared Budget API: wall-clock and step budget with soft/hard stops; hierarchical child budgets for subcalls.
- Transposition-lite: compact key for (leader, trick state, holdings mask hints) to reuse rollouts within a bench; time/step aware LRU.
- Move ordering: heuristic base score + continuation bias; stable, deterministic ordering when required.

M2) Depth 2–3 with Selective Branching
- Current trick (full) → next trick (top-K leads) → first reply (canonical + dump variants) → optional second reply (budget‑gated) → leader pickup.
- Promotions/cutoffs: quiescence when penalties=0 and we are not capturing; widen only on high‑leverage nodes.
- Alpha–beta window for totals with early rejection of dominated candidates.

M3) Opponent Modeling
- Per‑seat suit voids (already present) + light penalty propensity: prefer QS/♥ dumps when provisional winner is leader.
- Deterministic sampling (seeded) for off‑suit dumps with cap and reproducibility.

M4) Evaluation & Continuation Signals
- Extend continuation parts: QS exposure risk, hearts control drift, control handoff, moon‑aware relief.
- Calibrate tiny weights; cap aggregate continuation influence to avoid destabilizing Normal behavior.

M5) UX & Tooling
- CLI flags for all Hard knobs (done) + optional inline verbose continuation parts on console.
- Bench‑check guardrails (env thresholds) and a summary mode for short reports.
- Deterministic CSV harvesting workflow (already in place) + seed scanners for mid‑trick states.

M6) Tests/Goldens
- Exact flips (deterministic) per seat (done) + at least one mid‑trick flip where deeper probe changes the outcome.
- Multi‑void follow‑ups under changing leaders; endgame near‑100 capture avoidance.
- Performance: p95 < 20–30ms under agreed caps; no long‑tail spikes.

Guardrails
- Defaults conservative; deeper search, sampling, and tie‑breaks remain opt‑in until stabilized with goldens and perf.
- Keep explain vs choose parity where it helps debugging; allow early cutoff in choose only when documented.

Acceptance
- Deterministic mode reproducible across toolchains for CI.
- Expanded goldens remain green; perf snapshot meets guardrails.

