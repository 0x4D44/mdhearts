Hard Endgame Micro-solver — High-Level Design (2025-10-24)

Objective
- Provide a tiny, budget-capped endgame solver for <= N remaining cards per hand (default N=3) to strengthen Hard in decisive late phases without affecting Normal or destabilizing explain determinism.

Constraints and Non-goals
- Choose-only: explain path remains deterministic and unchanged unless explicitly requested with env flags for analysis.
- Strict budget: re-use Hard’s Budget; hard stop on step/time caps; deterministic mode respects step caps for tests/CI.
- Small, tunable influence: final continuation adjustments are bounded by a cap; defaults produce no behavior change (env opt-in).
- No full search: focus on immediate trick and next-trick(s) limited depth; no opponent model beyond existing void-aware follow-ups; prioritize stability and speed.

Scope
- Trigger: when each seat’s hand size <= MDH_HARD_ENDGAME_MAX_CARDS (default 3), and MDH_HARD_ENDGAME_DP_ENABLE=1.
- Inputs: RoundState clone at various points during Hard continuation (after current trick rollout and/or during next-trick probe), BotContext, provisional leader/leader_target, Budget.
- Output: small integer continuation delta (positive favors feeding leader/achieving safe outs; negative for self-capture risk), clamped by MDH_HARD_CONT_CAP.

Approach
- Depth-1..2 deterministic probe (budget-capped):
  - Enumerate our plausible leads (ordered by heuristic) and canonical opponent replies (void-aware policy already in place), mirroring next_trick_probe but with a more endgame-specific evaluation.
  - Score outcomes using tiny signals: penalties transferred to leader vs us, ability to maintain control or force dumps, QS exposure resolved, trick count remaining.
- Deterministic and tier-aware:
  - Only enabled for Hard choose; tier gating optional (default on for all tiers in endgame; can refine later).
  - Respect Hard deterministic mode; step-capped to keep tests stable.

Knobs (env)
- MDH_HARD_ENDGAME_DP_ENABLE (default 0/off): enable micro-solver in Hard choose path.
- MDH_HARD_ENDGAME_MAX_CARDS (default 3): max remaining cards per hand to trigger solver.
- MDH_HARD_ENDGAME_BONUS (default 0): small additive continuation delta from the solver (kept tiny); further weighting can be added later if needed.

Safety
- Defaults keep behavior unchanged (off / zero weights).
- Continuation remains clamped by MDH_HARD_CONT_CAP; early exit on budget exhaustion.
- Explain path remains deterministic (no micro-solver) for tuning and parity.

Validation
- Smoke test: constructed <=3-cards-per-hand scenario with MDH_HARD_ENDGAME_DP_ENABLE=1; ensure explain/choose run and return candidates; optionally assert stats present.
- Non-regression: all existing goldens remain green with default (off); optional targeted golden later to confirm micro-solver influence when enabled.

Rollout
- Phase 1: scaffold + env-gated integration + smoke tests.
- Phase 2: add tiny evaluation signals and a deterministic branch count under strict caps; evaluate mixed-seat impact; keep default off until gains are demonstrated.

