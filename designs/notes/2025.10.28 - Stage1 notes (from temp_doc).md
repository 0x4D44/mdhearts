# 2025.10.27 - Stage 1 mixed-seat summary

| Mix | Seat | Mean pen (off) | Mean pen (on) | Delta (off-on) | Avg nudge hits (on) |
|-----|------|----------------|---------------|----------------|---------------------|
| nnhh | north | 6.969 | 6.969 | 0.000 | 0.000 |
| nnhh | east | 6.190 | 6.190 | 0.000 | 0.000 |
| nnhh | south | 6.474 | 6.474 | 0.000 | 0.000 |
| nnhh | west | 6.436 | 6.438 | -0.002 | 0.106 |
| nnhh | ALL |  |  | 0.000 |  |
|-----|------|----------------|---------------|----------------|---------------------|
| hhnn | north | 6.969 | 6.969 | 0.000 | 0.000 |
| hhnn | east | 6.190 | 6.190 | 0.000 | 0.000 |
| hhnn | south | 6.474 | 6.474 | 0.000 | 0.000 |
| hhnn | west | 6.436 | 6.438 | -0.002 | 0.094 |
| hhnn | ALL |  |  | 0.000 |  |
|-----|------|----------------|---------------|----------------|---------------------|
Notes (2025-10-28):
- Deterministic evaluation (1,000 seeds, `MDH_HARD_DETERMINISTIC=1`):
  - West NNHH - off: 6.436, on: 6.438, delta (off-on): -0.002, avg `nudge_hits`: 0.106 (CSV pair: `tmp/stage1_off_west_nnhh_1000_eval_v2.csv`, `tmp/stage1_on_west_nnhh_1000_eval_after_v3.csv`).
  - West HHNN - off: 6.436, on: 6.438, delta: -0.002, avg `nudge_hits`: 0.094 (CSV pair: `tmp/stage1_off_west_hhnn_1000_eval_v2.csv`, `tmp/stage1_on_west_hhnn_1000_eval_after_v3.csv`).
- Added `MDH_HARD_PLANNER_NUDGE_ROUND_CAP` (default 15) to block feeds once the target already leads the round by a large penalty margin; the guard reports `round_leader_saturated` in trace logs.
- 2025-10-29: tightened the default round cap to 6 so the feed guard trips earlier when a single seat is hoovering hearts; see `tmp/stage1_check_west_hhnn_after_patch7.csv` for the new trace (blank `nudge_guard` indicates the trace env wasn’t set for that spot check).
- Combined with the round-leader self-capture penalty, previously regressive seeds (1702, 1749, 1401) now match or beat their Normal baselines.
- Remaining NNHH drift (-0.002) comes from a handful of seeds where feeders naturally dump to catch up; we can revisit feeder heuristics if we want to chase another few millipoints.
- 2025-10-28 follow-up:
  - Introduced a tie-fed penalty inside the Hard planner nudge (`round_tie_feed_penalty`) so that feeding a round leader while match scores are flat now subtracts `penalties * (leader_feed_per + 600)` before the nudge applies. This blunts the large positive base we were still seeing on seeds 1000/1002/1026 (see `tmp/analyze_west_1000_nnhh_after_patch2.log` for the new debug part).
  - Deterministic spot checks (`tmp/stage1_check_west_hhnn_after_patch2.csv`, `tmp/stage1_check_west_nnhh_after_patch.csv`) still show seed 1000 at 4 penalties (gap guard trips before the nudge can apply). The change does, however, remove the planner bias toward void-creation when the leader tie persists; remaining hits are coming from `gap_below_min`.
  - Next action: consider relaxing `MDH_HARD_PLANNER_NUDGE_GAP_MIN` to 3 for HHNN, or adding a per-trick bump when `scores_flat && round_gap >= 3` so the guard can fire on these near-tie cases.
  - 2025-10-28 (later): the guard now treats score-flat situations as two points more lenient (`min_gap` effectively becomes 2 when `scores_flat`). With the rebuilt binary the HHNN trace for seed 1000 now reports `round_leader_saturated` (round cap reached) instead of `gap_below_min`, so the remaining four penalties are coming from late-round saturation rather than the tie guard (`tmp/stage1_check_west_hhnn_after_patch6.csv`, `tmp/analyze_west_1000_hhnn_after_patch6.log`).

Cross-seat sanity sweep (deterministic, 1K unless noted):

| Seat | Mix | Off | On | Delta (off-on) | Avg nudge hits | Notes |
|------|-----|-----|----|----------------|----------------|-------|
| West | HHNN | 6.436 | 6.438 | -0.002 | 0.094 | `round_leader_saturated` ≈14 hits/200 |
| West | NNHH | 6.436 | 6.438 | -0.002 | 0.106 | Seeds 1702/1749/1401 back to parity |
| East | HHNN | 6.324 | 6.306 | 0.018 | 0.094 | Slight Hard edge |
| East | NNHH | 6.324 | 6.322 | 0.002 | 0.106 | Guard fires 20×/200, still neutral |
| South | HHNN¹ | 6.400 | 6.400 | 0.000 | 0.095 | 200-seed sample |
| South | NNHH¹ | 6.400 | 6.390 | 0.010 | 0.085 | 200-seed sample |
| North | HHNN¹ | 6.120 | 6.120 | 0.000 | 0.095 | 200-seed sample |
| North | NNHH¹ | 6.120 | 6.125 | -0.005 | 0.085 | 200-seed sample |

¹200-seed deterministic sweep. Inputs live under `tmp/stage1_on_*_*_200_eval_v3.csv` and matching `stage1_off` files. Guard breakdowns per seat: `tmp/stage1_on_*_*_200_trace_v3.csv`.
\nFor future reference: consider copying key CSV/trace outputs from tmp/ to designs/tuning/stage1/ (or rerunning the commands above) before archiving this branch.

## Stage 2 moon / round-gap notes (2025-10-28)

- Guard update: `choose_followup_card` now keeps `avoid_heavy_dump` engaged for committed-moon seats once either (a) another player has collected penalties or (b) the in-round gap reaches `MDH_STAGE2_ROUND_GAP_CAP`. This prevents the committed hunter from ignoring the cap after the moon is already busted.
- Added a clean-trick capture penalty (`round_gap_clean_capture_penalty`) that applies when we are already over the cap and still poised to win a zero-penalty trick; seed 1072 still lands at 25 penalties, so the follow-up needs to fire earlier in the sequence (current logs show the guard blocking dumps but leaving the zero-penalty grab untouched).
- Replays (`tmp/analyze_west_1072_hard_after_patch3.log`, `tmp/analyze_east_1066_hard.log`) still finish at 25 penalties. The residual spike comes from the `gap_below_min` guard (score gap \<4) allowing the first QS feed in seed 1072 and from forced trick-wins once the hunter is voided.
- Next ideas:
  - Lower `MDH_HARD_PLANNER_NUDGE_GAP_MIN` or add a round-gap boost so HHNN can block the first QS feed when match totals are still flat.
  - Expand the Stage 2 follow-up heuristic so that once our round total exceeds `cap`, we treat clean trick wins as negative when leading (not just when following).
  - Add targeted tests: (i) a constructed moon-abort scenario where another seat nicks a single heart, (ii) a follow-up card test covering `avoid_heavy_dump` with `committed_moon`.



