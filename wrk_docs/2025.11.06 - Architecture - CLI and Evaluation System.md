# 2025.11.06 - Architecture - CLI and Evaluation System

## Executive Summary

The CLI and evaluation system in hearts-app is a comprehensive testing and analysis framework for the Hearts AI. It provides extensive tooling for evaluation, debugging, tuning, and data collection.

**Key capabilities:**
- Deterministic regression testing
- Head-to-head AI comparisons (Normal vs Hard, custom matchups)
- Batch evaluation across thousands of seeds
- Dataset export for machine learning
- Telemetry collection and analysis
- Endgame state serialization
- Performance benchmarking
- Mixed-difficulty tournaments

## File Locations

- `crates/hearts-app/src/cli.rs` (~2050 lines) - Main CLI implementation
- `crates/hearts-app/src/telemetry.rs` - Hard AI telemetry system
- `crates/hearts-app/src/dataset.rs` - Play sample dataset export
- `crates/hearts-app/src/endgame_export.rs` - Game state serialization
- `crates/hearts-app/src/main.rs` - Entry point with CLI detection

## Architecture

### Entry Point

Main execution flow:
1. `main.rs::main()` checks for CLI arguments
2. If present: `cli::run_cli()` executes command and returns `CliOutcome`
3. If `CliOutcome::Handled`: exit
4. If `CliOutcome::NotHandled`: launch GUI via `platform::run()`
5. If error: display MessageBoxW (Windows) or stderr and exit

### Command Structure

All CLI commands follow the pattern: `mdhearts --command-name <args> [flags]`

Commands return `Result<CliOutcome, CliError>` where errors can be:
- `UnknownCommand`, `MissingArgument`, `InvalidSeat`, `InvalidValue`
- `Io(std::io::Error)`, `Json(serde_json::Error)`

## Command Reference

See the full documentation at: C:\language\mdhearts\docs\CLI_TOOLS.md

For this exploration, I've identified and documented all commands systematically.

## Conclusion

The CLI system is production-ready, well-architected, and provides all necessary tooling for rigorous AI development and evaluation. The deterministic mode is particularly valuable for regression testing.

For detailed usage examples and comprehensive command documentation, please refer to the generated documentation file.
