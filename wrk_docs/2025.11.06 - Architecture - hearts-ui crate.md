# hearts-ui Crate Architecture

**Document Date:** 6 November 2025

## 1. Overview and Purpose

The hearts-ui crate provides presentation metadata and resource management abstractions for the mdhearts application. It serves as a thin, platform-independent layer that bridges game assets (card themes, table backgrounds) with the rendering layer, intentionally avoiding direct Win32/WinUI API dependencies to maintain separation of concerns.

### Core Responsibilities
- **Asset manifest management**: Load and expose theme metadata from a build-time generated manifest
- **Theme configuration**: Provide composable theme descriptors combining card styles and table backgrounds  
- **Resource key abstraction**: Decouple UI code from physical asset file paths using logical keys
- **Placeholder fallback**: Ensure graceful degradation when asset manifests are unavailable

### Design Philosophy
The crate follows the principle of minimal coupling: it knows about asset metadata but not rendering, game logic, or platform specifics. This enables:
- Clean separation between data and presentation
- Platform portability (future non-Windows targets)
- Independent testing of resource logic
- Easy asset pipeline evolution without code changes

## 2. Module Breakdown

The crate contains only 4 source files totaling approximately 160 lines of code:
- src/lib.rs: Minimal crate root exposing public modules (4 lines)
- src/resource.rs: Asset manifest and theme metadata structures (74 lines)
- src/theme.rs: Theme composition and built-in theme generation (59 lines)
- build.rs: Build-time manifest integration (26 lines)

### 2.1 resource Module (src/resource.rs)

Purpose: Manages asset metadata through a build-time manifest system.

Key Types:

CardTheme - Represents a complete card deck styling
- key: String - Logical identifier (e.g., "cards/default")
- display_name: String - User-facing name (e.g., "CLASSIC DECK")
- asset_prefix: String - Path prefix for loading card textures

TableTheme - Represents table background theming
- key: String - Logical identifier (e.g., "theme/classic_felt")
- display_name: String - User-facing name (e.g., "CLASSIC FELT")
- texture_path: String - Relative path to background texture

AssetManifest - Central registry of all available themes
- card_themes: Vec<CardTheme>
- table_themes: Vec<TableTheme>

Loading Strategy:

The manifest loading follows a three-tier fallback approach:

1. Build-time manifest: Check HEARTS_ASSET_MANIFEST environment variable (set by build.rs)
2. Parse and deserialize: Attempt JSON deserialization of the manifest file
3. Placeholder fallback: If any step fails, use hardcoded defaults

This ensures the application can always function, even in incomplete build environments or during testing.

Placeholder Configuration:
- Default card theme: "CLASSIC DECK" (cards/default)
- Default table theme: "CLASSIC FELT" (theme/classic_felt)

Public API:
- AssetManifest::current() -> &'static AssetManifest - Access the singleton manifest instance
- AssetManifest::placeholder() -> Self - Create a minimal fallback manifest for testing

### 2.2 theme Module (src/theme.rs)

Purpose: Provides high-level theme composition by combining card and table themes into user-selectable presets.

Key Types:

ThemeDescriptor - Represents a complete visual theme
- name: String - User-facing theme name
- background_key: String - Reference to TableTheme key
- card_style_key: String - Reference to CardTheme key

This is the primary unit of customization exposed to users through settings.

Theme Generation:

built_in_themes() -> Vec<ThemeDescriptor>

Dynamically constructs available themes by combining all card themes with table themes using an iterator zip with cycle().

Design Notes:
- Uses cycle() to repeat table themes if there are more card themes than table themes
- Falls back to a single default theme if manifest loading failed
- Theme names are derived from card display names for consistency
- Guarantees at least one theme is always available (critical for initialization)

Default Theme: "Classic Felt" with theme/classic_felt background and cards/default cards

### 2.3 Library Root (src/lib.rs)

Minimal public interface exposing the two core modules. The crate enforces #![deny(warnings)] to maintain code quality.
