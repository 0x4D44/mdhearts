# MDHearts Architecture Documentation Index

**Date:** 2025-11-06
**Purpose:** Master index for complete architecture documentation

---

## Overview

This directory contains a comprehensive architecture analysis of the MDHearts codebase, conducted through parallel exploration of all major components. The documentation provides both high-level overviews and deep technical details suitable for developers, maintainers, and researchers.

---

## Quick Start

**For a high-level overview**, start here:
- **[Architecture Summary](2025.11.06%20-%20Architecture%20Summary.md)** - Executive summary synthesizing all findings

**For component-specific details**, see the individual component documents below.

---

## Architecture Documentation Set

### 1. Architecture Summary (START HERE)
**File:** `2025.11.06 - Architecture Summary.md`

**Purpose:** High-level synthesis of the entire architecture

**Contents:**
- Executive summary with key metrics
- Three-tier architecture overview
- AI system architecture (4 difficulty levels)
- Platform integration (Win32/Direct2D)
- CLI evaluation system
- Controller orchestration
- Build system & CI
- Key design decisions
- Data flow diagrams
- Quality attributes achieved

**Audience:** All stakeholders - provides the big picture before diving into details

---

### 2. hearts-core Crate
**File:** `2025.11.06 - Architecture - hearts-core crate.md`

**Purpose:** Complete analysis of the pure game logic layer

**Contents:**
- Crate structure and module organization
- All model types (Card, Rank, Suit, Hand, Trick, RoundState, ScoreBoard, etc.)
- Game rules implementation
- Shoot the moon logic
- Deterministic shuffling
- Snapshot serialization system
- Public API patterns
- Invariants and constraints
- Testing strategy

**Size:** ~246 lines, ~11.8 KB

**Key Insight:** Foundation of deterministic Hearts gameplay with zero unsafe code

---

### 3. hearts-ui Crate
**File:** `2025.11.06 - Architecture - hearts-ui crate.md`

**Purpose:** Presentation layer analysis

**Contents:**
- Resource module (card atlas metadata)
- Theme module (color schemes)
- Asset loading patterns
- Compile-time embedding strategy
- Graceful fallback design
- Future integration plans
- Current status (foundational, not yet fully integrated)

**Size:** ~180 lines

**Key Insight:** Well-designed but awaiting full integration into Win32 renderer

---

### 4. AI Bot System
**File:** `2025.11.06 - Architecture - AI Bot System.md`

**Purpose:** Comprehensive analysis of the sophisticated AI system

**Contents:**
- Core types (BotDifficulty, BotStyle, BotContext, DecisionLimit)
- PlayPlanner (Normal AI) - feature-based heuristic scoring
- PlayPlannerHard (Hard AI) - shallow search with continuation
- PassPlanner - card passing strategy
- UnseenTracker - void inference and beliefs
- Adviser system - external bias injection
- 60+ configuration parameters
- Performance characteristics
- Integration patterns
- Design rationale

**Size:** ~400 lines of documentation covering ~3,700 lines of bot code

**Key Insight:** Production-quality, research-grade AI demonstrating that shallow search + good heuristics can produce expert-level play

---

### 5. Platform Layer
**File:** `2025.11.06 - Architecture - Platform Layer.md`

**Purpose:** Win32/Direct2D native UI implementation

**Contents:**
- Window management (Win32 message loop)
- Direct2D rendering pipeline
- Animation system (3 types: Play, Collect, Pass)
- Asset management (WIC-based image loading)
- DPI awareness (Per-monitor V2)
- AI threading integration
- Safety considerations (211 unsafe blocks, all documented)
- Resource management (COM ref counting, device loss recovery)
- Event handling (15+ message types)

**Size:** ~167 lines

**Key Insight:** Clean platform abstraction with hardware-accelerated rendering and comprehensive DPI support

---

### 6. Controller & Orchestration
**File:** `2025.11.06 - Architecture - Controller and Orchestration.md`

**Purpose:** Game flow coordination layer

**Contents:**
- Controller architecture and responsibilities
- Game state management
- Bot decision integration (async with timeout/fallback)
- State coordination (UnseenTracker, moon state, telemetry)
- Integration patterns (Platform, Core, Bot)
- Flow control (Match→Round→Trick state machines)
- Player action handling
- Validation and error handling
- Threading model and synchronization
- Configuration (40+ environment variables)
- Testing support APIs
- Design patterns (delegation, snapshot isolation, fail-safe defaults)
- Performance characteristics
- Critical invariants

**Size:** ~650 lines, ~20 KB

**Key Insight:** Controller acts as orchestrator between hearts-core (rules), bot (AI), and platform (UI) with clean asynchronous bot integration

---

### 7. CLI & Evaluation System
**File:** `2025.11.06 - Architecture - CLI and Evaluation System.md`

**Purpose:** Command-line evaluation tools

**Contents:**
- CLI command structure (20+ commands)
- Snapshot export/import system
- Explain commands (6 variants)
- Compare commands (Normal vs Hard)
- Match-batch system (head-to-head evaluation)
- Mixed-seat evaluation
- Telemetry collection and export
- Dataset export for analysis
- Hard AI flags (20+ configuration options)
- Deterministic evaluation support
- Output formats (console, CSV, JSON, NDJSON)

**Status:** Executive summary with links to detailed CLI_TOOLS.md

**Key Insight:** Comprehensive evaluation infrastructure enabling reproducible AI research

---

### 8. Build System & Tooling
**File:** `2025.11.06 - Architecture - Build System and Tooling.md`

**Purpose:** Development infrastructure

**Contents:**
- Cargo workspace structure (3 crates)
- Dependency analysis and rationale
- Build scripts (timestamp generation, Windows resources)
- CI workflows (3 jobs: test, eval-smoke, ultra-smoke)
- Quality gates (-D warnings, clippy, tests)
- Tooling ecosystem (14 scripts: Bash + PowerShell)
- Testing infrastructure (74 test files, 2 benchmark suites)
- Asset management (cards, icons, resources)
- Packaging (Inno Setup installer)
- Documentation structure (docs/, designs/, wrk_docs/)
- Development workflows
- Performance optimization
- Troubleshooting guide

**Key Insight:** Sophisticated build system with strict quality enforcement and rich evaluation tooling

---

## Document Relationships

```
Architecture Summary (START HERE)
    │
    ├── hearts-core crate
    │   └── Pure game logic foundation
    │
    ├── hearts-ui crate
    │   └── Presentation abstractions (awaiting integration)
    │
    ├── AI Bot System
    │   ├── PlayPlanner (Normal AI)
    │   ├── PlayPlannerHard (Hard AI)
    │   ├── PassPlanner
    │   ├── UnseenTracker
    │   └── Adviser
    │
    ├── Platform Layer
    │   ├── Win32 window management
    │   ├── Direct2D rendering
    │   └── Animation system
    │
    ├── Controller & Orchestration
    │   ├── Game flow coordination
    │   └── Bot threading integration
    │
    ├── CLI & Evaluation System
    │   ├── 20+ commands
    │   └── 14 evaluation scripts
    │
    └── Build System & Tooling
        ├── Workspace structure
        ├── CI pipeline
        └── Quality gates
```

---

## Reading Guide by Audience

### For New Developers
1. Start with: **Architecture Summary**
2. Read: **hearts-core crate** (understand the foundation)
3. Read: **Controller & Orchestration** (see how it all fits together)
4. Skim: **Platform Layer** (understand UI integration)
5. Reference as needed: Other component docs

### For AI Researchers
1. Start with: **Architecture Summary** (AI system section)
2. Read deeply: **AI Bot System** (all details)
3. Read: **CLI & Evaluation System** (tools for research)
4. Reference: **Controller & Orchestration** (integration patterns)
5. Skim: **Build System & Tooling** (evaluation scripts)

### For Platform Developers
1. Start with: **Architecture Summary**
2. Read deeply: **Platform Layer** (Win32/Direct2D)
3. Read: **hearts-ui crate** (presentation abstractions)
4. Read: **Controller & Orchestration** (integration)
5. Reference as needed: **hearts-core crate** (game state types)

### For Maintainers
1. Read: **Architecture Summary** (full context)
2. Read: **Build System & Tooling** (infrastructure)
3. Reference: All component docs as needed
4. Keep: **Architecture Documentation Index** (this file) bookmarked

---

## Documentation Statistics

| Document | Lines | Size | Code Analyzed |
|----------|-------|------|---------------|
| Architecture Summary | ~450 | ~30 KB | Full codebase |
| hearts-core crate | ~246 | ~12 KB | ~2,500 lines |
| hearts-ui crate | ~180 | ~11 KB | ~160 lines |
| AI Bot System | ~400 | ~25 KB | ~3,700 lines |
| Platform Layer | ~167 | ~10 KB | ~5,700 lines |
| Controller & Orchestration | ~650 | ~20 KB | ~800 lines |
| CLI & Evaluation System | ~100 | ~6 KB | ~1,500 lines |
| Build System & Tooling | ~350 | ~22 KB | Infrastructure |
| **TOTAL** | **~2,543** | **~136 KB** | **~14,360 lines** |

---

## Exploration Methodology

This documentation was created through:

1. **Parallel Agent Exploration:** 7 specialized agents explored different components simultaneously
2. **Thoroughness Level:** "Very thorough" - all source files read and analyzed
3. **Synthesis:** Findings aggregated into comprehensive overview
4. **Quality:** Reviewed for accuracy, completeness, and clarity

Each agent was tasked with:
- Reading all relevant source files
- Analyzing architecture and design patterns
- Documenting key algorithms and data structures
- Identifying integration points
- Noting performance characteristics
- Explaining design rationale

---

## Related Resources

### External Documentation
- **README.md** - Quick start and command reference
- **docs/CLI_TOOLS.md** - Complete CLI documentation
- **docs/CODING_STANDARDS.md** - Code style and conventions
- **docs/CONTRIBUTING_AI_TUNING.md** - AI tuning guide
- **designs/INDEX.md** - Design document index (162 docs)

### Codebase Entry Points
- **Game engine:** `crates/hearts-core/src/model/round.rs` (~800 lines)
- **Normal AI:** `crates/hearts-app/src/bot/play.rs` (~1,700 lines)
- **Hard AI:** `crates/hearts-app/src/bot/search.rs` (~1,900 lines)
- **Win32 UI:** `crates/hearts-app/src/platform/win32.rs` (~5,700 lines)
- **Controller:** `crates/hearts-app/src/controller.rs` (~800 lines)
- **CLI:** `crates/hearts-app/src/cli.rs` + `main.rs`

---

## Maintenance

This documentation should be updated when:
- Major architectural changes occur
- New components are added
- Significant refactoring happens
- AI algorithms are substantially revised
- Platform integration changes

**Next Review:** When preparing next major release (1.1.0 or 2.0.0)

---

## Conclusion

This comprehensive architecture documentation provides:

✅ **Complete coverage** of all major components
✅ **Multiple entry points** for different audiences
✅ **Deep technical details** alongside high-level overviews
✅ **Design rationale** explaining key decisions
✅ **Integration patterns** showing how components work together
✅ **Performance characteristics** for critical paths
✅ **Quality attributes** achieved by the architecture

The documentation demonstrates that MDHearts is a **production-quality, research-grade implementation** with clean architecture, sophisticated AI, and comprehensive tooling.

**Total effort:** 7 parallel exploration agents + synthesis = comprehensive understanding of ~14,000+ lines of code

**Recommended use:** Keep this index handy and dive into specific component docs as needed for your work.
