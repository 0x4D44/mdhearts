# Plan: Multi-Stage Recovery Implementation (Search vs Hard + Mixed Seat)

_Generated: 2025-11-07 10:10 CT_

## Stage 0 - Situation & Guardrails
- **Inputs**: Think-limit batch artifacts (`designs/tuning/search_vs_hard/2025-11-06_090614/`), telemetry smokes, mixed-seat requirements (plan dated 2025-11-06), updated CLI/telemetry code paths.
- **Constraints**: No re-running 800-match batches unless data gaps appear; outage recovery window = 48h; docs must stay ASCII-safe.
- **Definition of Ready**: CSVs/telemetry accessible, repo builds locally, PowerShell scripts runnable.
- **Exit Criteria**: Stakeholders sign off on scope (Stages 1-4) and acknowledge risk log.

## Stage 1 - Data Analysis & Reporting (Think-Limit Study Stage 5/6)
1. **Artifact Harvest**
   - Script to parse match + compare CSVs per cap/seat -> compute avg/sigma, disagreement %, timeout counts.
   - Emit intermediate JSON/CSV caches under `tmp/search_vs_hard_stage5/` for repeatability.
2. **Report Assembly**
   - Markdown report `wrk_docs/2025.11.07 - RPT - search_vs_hard_stage5.md` with: methodology recap, per-seat tables, telemetry summary, key takeaways, open risks.
   - Include links to raw data and telemetry smoke evidence.
3. **Review Loop**
   - Self-review checklist (math double-check, citation of file paths, ASCII encoding).
   - Share draft internally (mention in wrk_journals) for async sign-off.
4. **Exit Criteria**
   - Report merged into wrk_docs, README/CLI_TOOLS cross-linked, journal entry logged.

## Stage 2 - Mixed-Seat Harness Implementation
1. **Design**
   - Spec exact CLI invocations (`--match-mixed`, `--match-mixed-file`, `--telemetry-out`, `--stats`).
   - Define script interface (`tools/run_search_vs_mixed.ps1` or flag-extended existing script) with parameters: mixes array, seat counts, think limits, telemetry smoke toggle.
2. **Implementation**
   - Reuse shared helpers (dir creation, think-limit args, telemetry smoke) and refactor when necessary into common module.
   - Support `-Mixes shsh,sshh,...`, `-SeedsFile`, default deterministic env (`MDH_HARD_DETERMINISTIC=1`).
3. **Validation**
   - Run 5-seed smoke per requested mix; store outputs under `designs/tuning/search_vs_mixed/<timestamp>/` (match CSV, telemetry, summary.md).
   - Add lightweight parser (PowerShell/Python) to sanity-check penalty deltas + telemetry fallback labels.
4. **Exit Criteria**
   - Script checked in, README/docs updated, smoke artifacts referenced in wrk_docs plan, backlog ticket opened for 200-seed full run.

## Stage 3 - Documentation & Encoding Cleanup
1. **README/Docs Pass**
   - Fix emoji/encoding placeholders (replace with ASCII text or stable icons).
   - Ensure `--think-limit*`, `--telemetry-out`, mixed-seat workflow are documented in README + `docs/CLI_TOOLS.md` (add cross-link to addendum if needed).
2. **Architecture References**
   - Update `ARCHITECTURE.md` summary to mention telemetry + think-limit plumbing; confirm index file points to latest reports.
3. **Change Log & Journal**
   - Add wrk_journal entry capturing completion of Stages 1-3 (actions taken, hashes run, blockers).
4. **Exit Criteria**
   - Markdown lint (if available) passes; reviewers confirm ASCII-safe text; docs link to new reports/scripts.

## Stage 4 - Readiness & Handoff
1. **Verification Checklist**
   - `cargo fmt` / `cargo test -p hearts-app controller::tests::*think_limit*` / targeted script dry-run logs saved under `tmp/verification/`.
   - Ensure telemetry smoke toggles off after tests (env cleanup script snippet in docs).
2. **Packaging**
   - Update `wrk_docs/2025.11.07 - PLN - post_power_recovery.md` with status per stage.
   - Prepare PR/hand-off notes summarizing completed stages, pending large batch (Stage 2 full run), and doc links.
3. **Exit Criteria**
   - Stakeholder ACK on readiness checklist, Git status clean aside from intentional artifacts, plan docs linked in README.

## Timeline & Ownership
- **Day 0 (Nov 7 AM)**: Finish Stage 0 sign-off, begin Stage 1 scripting.
- **Day 0 (Nov 7 PM)**: Stage 1 report drafted, README placeholders queued.
- **Day 1 (Nov 8 AM)**: Stage 2 script + smoke runs.
- **Day 1 (Nov 8 PM)**: Stage 3 doc polish, Stage 4 verification/handoff.
- **Owner**: mdhearts evaluation team (primary: repo maintainer recovering from outage).

## Risks & Mitigations
- **Data drift**: If CSV parsing uncovers inconsistencies, fall back to rerunning minimal batches (20 seeds) before claiming finality.
- **Script regression**: New mixed-seat script may duplicate logic; factor shared helper extraction early to reduce bug surface.
- **Doc debt**: Encoding issues could block PR; dedicate explicit buffer in Stage 3 for testing on Windows terminals.
- **Time overruns**: If Stage 2 smoke fails, downgrade goal to single mix while logging blocker in journal.
