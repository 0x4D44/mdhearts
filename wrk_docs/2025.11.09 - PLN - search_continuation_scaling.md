# Plan: Search Continuation Scaling Push

_Generated: 2025-11-09 23:25 UTC_

## Context
- 60-seed snnh/shsh sweeps from `designs/tuning/search_vs_mixed/2025-11-09_231623/` show Search (north) scanning ~4 moves at 20 s yet penalties stay flat (≈6.40) while Hard west remains ≤6.58.
- Search only beats Hard at ≤10 s in snnh (−0.18 pen) and loses to Hard in shsh (+0.03–0.18 pen), so more think time still fails to improve EV.
- Telemetry already proves extra work happens (utilization 6.5 vs 3.2), so the next iterations must alter continuation scoring so the enlarged tree yields better choices.

## Goals & Success Criteria
1. **Think-time responsiveness:** ≥0.2 penalty drop for Search when moving 5 s → 15 s in both snnh & shsh mixes.
2. **Seat competitiveness:** Search’s north seat ≤ Hard west at every limit, and east seat ≤ 6.7 average penalty in shsh.
3. **Evidence & guardrails:** Telemetry deltas + deterministic tests showing Phase B/C samples increase and don’t regress Hard.

## Stage 0 – Baseline assimilation *(complete)*
- Lock in analysis JSON for 2025-11-09_231623 and document current gaps (done in `wrk_docs/2025.11.07 - RPT - search_scaling_telemetry.md`).

## Stage 1 – Continuation heuristic reweighting
- Wire AB-margin dependent multipliers into `SearchConfig::high_budget` so higher limits scale `moon_relief_perpen`, leader-feed bonuses, and continuation penalties together.
- Add seat-aware boost: when Search sits north/east and trails leader by ≥6, inject +Δ into `phaseb_topk` and reduce early-cutoff pressure.
- Ensure new knobs stay behind config flags for rapid iteration.

## Stage 2 – Budget-aware depth gating & telemetry
- Tie `phasec_branch_limit` and `scored_width` to think limit buckets (5 s, 10 s, 15 s, 20 s+) with smooth ramping instead of current binary switch.
- Extend telemetry (`search_stats`) with per-phase eval deltas so we can attribute EV changes to depth vs heuristic shifts.
- Guard regressions via `cargo test -p hearts-app controller::tests::search_autoplay_records_think_limit` + timeout fallback tests.

## Stage 3 – Mixed-seat validation loop
1. Re-run `tools/run_search_vs_mixed.ps1` for snnh & shsh at 5/10/15/20 s (40–60 seeds/seat) with telemetry export.
2. Auto-summarize penalties & scan/util deltas via `tools/analyze_search_vs_mixed.py`; fail the run if Search doesn’t gain ≥0.2 pen between 5 s and 15 s.
3. Capture before/after comparisons in `wrk_docs/2025.11.07 - RPT - search_scaling_telemetry.md` and surface high-level answer to “is Search better than Hard?”.

## Stage 4 – Reporting & operationalization
- Update `README` + CLI docs once improvements land, highlighting mix results and new knobs.
- Produce a final summary + risk log in `wrk_docs/2025.11.07 - RPT - search_scaling_telemetry.md` and a status journal entry.
- Decide on rollout flag defaults (e.g., `MDH_SEARCH_HIGH_BUDGET=on`) and add rollback instructions.

## Dependencies & Risks
- Mix sweeps remain long (≈2 h). Schedule overnight runs or split mixes to avoid blocking.
- Leader-feed scaling touches shared evaluation code; coordinate with Hard team to prevent regressions.
- Additional telemetry fields may increase NDJSON size; monitor disk usage under `designs/tuning/search_vs_mixed/*`.

## Tracking & Next Steps
- Continue journaling in `wrk_journals/2025.11.09 - JRN - search_scaling.md`.
- Immediately start Stage 1 implementation (continuation weighting). Stage 2+ kickoff depends on seeing EV movement in smoke tests.
