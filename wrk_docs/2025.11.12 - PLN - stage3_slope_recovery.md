# Plan: Stage 3 Slope Recovery After Power Cut

_Generated: 2025-11-12 09:30 CT_
_Related context: wrk_journals/2025.11.11 - JRN - search_scaling.md, wrk_docs/2025.11.11 - PLN - depth2_mix_hint.md, crates/hearts-app/src/bot/search.rs, crates/hearts-app/src/bot/play.rs, tools/run_search_vs_mixed.ps1._

## Snapshot
- Depth2 forcing + continuation schedule plumbing is live (search.rs lines 202-276 & 681-799) and the sweep harness now propagates MDH_SEARCH_MIX_HINT plus per-seat hard-step boosts (tools/run_search_vs_mixed.ps1 lines 25-183).
- Mix-aware heuristics landed in play.rs (lines 69-671), but the 2025-11-11 22:55 smokes still show zero penalty slopes, so Stage 3 was mid-flight when the power cut happened.
- Latest telemetry artifacts (designs/tuning/search_vs_mixed/2025-11-11_224539, 225348, 225438) verify depth2 averages >=0.4 for target seats, so the remaining blocker is EV shaping, not probing.

## Work Interrupted
1. Strengthening the SNnH/ShSh seat-specific heuristics so slope_gates finally flip negative.
2. Capturing the mix-hint + continuation schedule workflow in docs/CLI_TOOLS.md and README so future agents know how to toggle the env hints safely.
3. Re-running the full 5/10/15/20s snnh+shsh sweep after the heuristic adjustments to confirm slopes < -0.1.

## Action Plan
### 1. Expand mix-aware heuristics (owner: search/play stack)
- Add stronger incentives in play.rs for SNnH (north/east) seats when continuation_scale_permil >=1300: e.g., larger bonus for non-capturing leader feeds, harsher penalty for capturing penalties, and mix-aware AB-margin clamps.
- For ShSh (east/south/west), bias against captures when penalties >0 and reward feeds to the leader even when continuation scale <1300 so Stage 3 can move slopes outside of pure continuation pressure.
- Gate every tweak behind MDH_SEARCH_MIX_HINT-derived seat checks to avoid regressing other workflows.

### 2. Instrumentation + safety
- Add debug counters or telemetry tags for the new heuristics (e.g., mix_hint_bias_applied) so analyzer JSON diffs can attribute slope changes.
- Extend tools/run_search_vs_mixed.ps1 with an optional -MixHintTrace switch that echoes the current MDH_SEARCH_MIX_HINT per seat when -Verbose is set, making it easier to audit env drift during long sweeps.
- Update docs/CLI_TOOLS.md with a short “Mix hints & continuation schedules” section covering MDH_SEARCH_MIX_HINT/MDH_CONT_SCHEDULE_PATH usage plus cleanup expectations.

### 3. Validation cadence
1. Targeted smokes: snnh 15/20s (count 10) and shsh 15/20s with telemetry to ensure the heuristic toggles fire and depth2 remains >=0.5.
2. Full sweep: pwsh tools/run_search_vs_mixed.ps1 -Mixes snnh,shsh -Count*=40 -ThinkLimitsMs @(5000,10000,15000,20000) -HardSteps 200 -TelemetryOut -IncludeStats with MDH_CONT_SCHEDULE_PATH pointing at the latest fit.
3. Analyzer review: python tools/analyze_search_vs_mixed.py --root designs/tuning/search_vs_mixed/<timestamp> --out tmp/search_vs_mixed/<timestamp>_stage3.json focusing on seat_trends slope < -0.1 and fails_goals clearing for both mixes.
4. If slopes remain flat, iterate on continuation fitter (allow >1850 permil for mixes still stalled) before touching other heuristics.

### 4. Documentation + handoff
- Summarize the results + toggles in wrk_docs (update this plan with outcomes, add a short RPT once slopes move).
- Capture any remaining TODOs (e.g., apply_schedule_hints refactors) in wrk_journals for the next shift.

## Exit Criteria
- Penalty slopes <= -0.1 for SNnH east/north and ShSh east/south at 15s+ buckets with depth2 averages >=0.5.
- docs/CLI_TOOLS.md includes an explicit “Mix hint + continuation schedule” subsection.
- Latest wrk_journal entry documents the sweep + analyzer deltas so future outages have a clean baseline.
