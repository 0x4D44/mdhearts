# 2025.11.20 - Code Review Plan (mdhearts)

## 0) Scope and inventory
- Production code: `crates/hearts-core` (rules + match engine), `crates/hearts-app` (controller, bots, CLI, platform front-ends), `crates/hearts-ui` (themes/assets manifest).  
- Auxiliary: tools scripts (`tools/`), installation scripts (`installers/Hearts.iss`), docs (README/ARCHITECTURE), data assets (`assets/`), temporary analytics (`tmp/`, `designs/`, `wrk_docs/` historical reports).
- Tests/benches: extensive under `crates/hearts-app/tests`, `crates/hearts-app/benches`, unit tests within `hearts-core`.

## 1) Review goals
- Correctness of Hearts rules (passing, trick play, scoring, shoot-the-moon, leading constraints, start-seat logic).
- Bot behaviour: decision flow, time limits, difficulty flags, belief tracking, continuation/search heuristics, moon-strategy heuristics.
- Determinism/reproducibility: seed handling, randomness, CLI/export commands.
- Safety & robustness: error handling, panics, env flag parsing, telemetry/file IO, Windows-specific APIs.
- Performance considerations: needless cloning, hot-path allocations, cache retention.
- UX/API: CLI surface, status/telemetry text, platform hooks.
- Test coverage gaps and recommendations.

## 2) Approach
1. **Rules engine (hearts-core):** walk card/suit/rank, deck, passing, trick, round, match-state + serialization; compare to Hearts rules and test coverage; note edge cases (first trick, hearts broken, passing flow, scoring).
2. **App controller layer:** review `controller.rs` for game orchestration, bot plumbing, timeout fallbacks, moon-state updates, telemetry hooks; check env-flag handling and status text.
3. **Bots & planners:** skim `bot/` modules (play/search/search_deep/endgame/pass/adviser/tracker) focusing on decision limits, belief updates, continuation scoring; spot high-risk areas or TODOs.
4. **CLI & dataset/export:** validate argument parsing, hard-flag handling, file writes, deterministic exports.
5. **Telemetry:** retention policy, NDJSON export, summary math.
6. **UI/platform:** brief pass over `hearts-ui`, Win32/WinUI shells for obvious safety/UX issues.
7. **Tests/benches/config:** inspect representative tests, benches, Cargo manifests; note missing coverage or potential build/publish pitfalls.
8. **Synthesize report:** findings ordered by severity, with file refs and remediation suggestions.

## 3) Deliverables
- Comprehensive review report saved under `wrk_docs/` named `2025.11.20 - CR - <desc>.md`.
- This plan file (you are reading it) to evidence planned workflow.

## 4) Time/effort focus
- Prioritize correctness and determinism in core rules and controller/bot decision pipeline.
- Secondary: UX polish (status text, diagnostics), resource/telemetry safety, Windows-specific robustness.
