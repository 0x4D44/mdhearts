# Code Review Plan - mdhearts

**Date:** 2025-12-01
**Reviewer:** Claude
**Scope:** Comprehensive review of all production code

---

## Code Inventory

### hearts-core (15 files)
Core game logic - deterministic, platform-independent

| File | Purpose |
|------|---------|
| `src/lib.rs` | Crate root, public exports |
| `src/game/mod.rs` | Game module organization |
| `src/game/match_state.rs` | Multi-round match state |
| `src/game/serialization.rs` | Snapshot save/load |
| `src/model/mod.rs` | Model module organization |
| `src/model/card.rs` | Card type (rank + suit) |
| `src/model/deck.rs` | Deck creation and shuffling |
| `src/model/hand.rs` | Player hand management |
| `src/model/player.rs` | Player/Seat types |
| `src/model/rank.rs` | Card ranks (2-A) |
| `src/model/suit.rs` | Card suits |
| `src/model/trick.rs` | Trick state and resolution |
| `src/model/score.rs` | Scoring logic |
| `src/model/round.rs` | Round state machine |
| `src/model/passing.rs` | Card passing logic |

### hearts-ui (3 files)
Presentation layer - asset/theme management

| File | Purpose |
|------|---------|
| `src/lib.rs` | Crate root |
| `src/resource.rs` | Asset embedding |
| `src/theme.rs` | Color schemes |

### hearts-app (18 source files)
Platform + AI + CLI

| File | Purpose |
|------|---------|
| `build.rs` | Build script (timestamps, resources) |
| `src/lib.rs` | Crate root, public API |
| `src/main.rs` | Entry point |
| `src/cli.rs` | CLI argument parsing and commands |
| `src/controller.rs` | Game orchestration |
| `src/dataset.rs` | Research data export |
| `src/endgame_export.rs` | Endgame position export |
| `src/telemetry.rs` | AI decision telemetry |
| `src/bot/mod.rs` | Bot types, difficulty levels |
| `src/bot/adviser.rs` | External bias system |
| `src/bot/endgame.rs` | Perfect endgame solver |
| `src/bot/pass.rs` | Card passing AI |
| `src/bot/play.rs` | Normal heuristic AI |
| `src/bot/search.rs` | Hard search AI |
| `src/bot/search_deep.rs` | Ultra-hard deep search |
| `src/bot/tracker.rs` | Card tracking, belief state |
| `src/platform/mod.rs` | Platform abstraction |
| `src/platform/win32.rs` | Win32/Direct2D UI |
| `src/platform/winui.rs` | WinUI placeholder |

### Test Files (71 files)
Located in `crates/hearts-app/tests/`

### Benchmark Files (2 files)
- `benches/heuristic_decision.rs`
- `benches/hard_decision.rs`

### Build/Tooling
- 5 Cargo.toml files
- 1 .cargo/config.toml
- 5 PowerShell scripts
- 13 Shell scripts

---

## Review Methodology

### Review Criteria

1. **Correctness**
   - Logic errors, off-by-one, edge cases
   - Game rules implementation accuracy
   - AI decision quality

2. **Safety**
   - Unsafe code justification and correctness
   - Panic potential (unwrap, expect, index)
   - Integer overflow/underflow
   - Memory safety

3. **Error Handling**
   - Result/Option usage
   - Error propagation
   - Fallback strategies

4. **Performance**
   - Algorithmic complexity
   - Unnecessary allocations
   - Hot path efficiency

5. **Code Quality**
   - Clarity and readability
   - DRY violations
   - Dead code
   - Documentation

6. **API Design**
   - Public API coherence
   - Type safety
   - Encapsulation

7. **Testing**
   - Coverage gaps
   - Test quality
   - Edge case coverage

---

## Review Order

### Phase 1: Core Game Logic (hearts-core)
Priority: HIGHEST - foundation for everything else

1. Model types (card, rank, suit, hand, trick)
2. Game rules (round.rs, score.rs)
3. Match state and serialization
4. Passing logic

### Phase 2: AI System (hearts-app/bot)
Priority: HIGH - complex algorithms

1. Bot types and context (mod.rs)
2. Card tracker (tracker.rs)
3. Normal AI (play.rs)
4. Hard AI (search.rs)
5. Deep search (search_deep.rs)
6. Endgame solver (endgame.rs)
7. Pass planner (pass.rs)
8. Adviser (adviser.rs)

### Phase 3: Application Layer
Priority: MEDIUM

1. Controller (controller.rs)
2. CLI (cli.rs)
3. Telemetry (telemetry.rs)
4. Dataset export (dataset.rs)

### Phase 4: Platform Layer
Priority: MEDIUM-HIGH (safety critical)

1. Win32 platform (win32.rs)
2. Platform abstraction (mod.rs)

### Phase 5: UI Crate (hearts-ui)
Priority: LOW (minimal code)

### Phase 6: Build & Tooling
Priority: LOW

1. Cargo.toml configurations
2. Build scripts
3. Shell/PowerShell scripts

### Phase 7: Tests
Priority: MEDIUM

1. Sample test files for patterns
2. Coverage assessment

---

## Deliverables

1. **Review Plan** (this document)
2. **Comprehensive Code Review Report** with:
   - Executive summary
   - Findings by severity (Critical, High, Medium, Low, Info)
   - Detailed analysis per component
   - Recommendations
   - Positive observations

---

## Timeline

Execute phases sequentially, reading and analyzing each file thoroughly.
