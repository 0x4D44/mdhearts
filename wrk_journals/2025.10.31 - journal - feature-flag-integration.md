# 2025.10.31 – Journal – feature-flag integration

## 10:05 – Decision recorded
- Agreed to proceed on main guarded by runtime flags instead of a separate branch.

## 10:15 – Plan drafted
- Wrote designs/2025.10.31 - Continue-On-Main via Feature Flags.md with scope, flags, and gating points.

## 10:40 – Code gating (Stage 1/2)
- Added `hard_stage1_enabled()` and `hard_stage2_enabled()` helpers (env-driven with OnceLock caching).
- Stage 1: wrapped planner nudge + guards in `base_score()` under Stage 1 flag.
- Stage 2: gated round-gap penalties in `base_score()` and heavy-dump/sim logic in `choose_followup_card()`.

## 11:05 – CLI + tooling
- CLI flags: `--hard-stage1`, `--hard-stage2`, `--hard-stage12`, plus `--hard-stage12-off`.
- `tools/smoke_fast.sh`: export `MDH_FEATURE_HARD_STAGE12=1`.
- CI: set `MDH_FEATURE_HARD_STAGE12=1` in PR smoke/eval jobs only.

## 11:20 – Docs
- README: new "Feature Flags (continue-on-main)" section.

## 11:25 – Next
- Build + quick smoke locally with flags ON and OFF.
- If stable, proceed to sweeps and revisit ignored tests.
