# 2025-11-07 Journal - Outage Recovery Implementation

## 09:40 - Kickoff
- Confirmed repo state after power cut (git status shows staged docs + numerous new artifacts).
- Reviewed multi-stage recovery plan (2025.11.07 - PLN - multi_stage_recovery.md) as execution guide.
- Created this journal to log progress per stage and guardrail decisions.

## 09:50 - Stage 0 Checkpoint
- Inputs validated: existing think-limit summaries + telemetry smokes accessible, CLI updates already merged locally.
- Constraints noted: avoid new 800-seat runs, maintain ASCII-only docs, aim for 48h recovery window.
- Ready to proceed with Stage 1 scripting (data harvest/reporting) next.

## Next Steps
1. Stage 1 Artifact Harvest script scaffold (PowerShell/Python) pointed at `designs/tuning/search_vs_hard/2025-11-06_090614`.
2. Define output structure for Stage 5 report (`wrk_docs/2025.11.07 - RPT - search_vs_hard_stage5.md`).
3. Backfill journal entries whenever Stage 1 subtasks complete.
## 10:00 - Stage 1 Artifact Harvest
- Added `tools/analyze_search_vs_hard_stage5.py` to parse match/compare CSVs and telemetry into JSON aggregates.
- Cached metrics under `tmp/search_vs_hard_stage5/analysis.json` (includes avg/sigma + timeout mix per cap).
- Drafted Stage 5 report skeleton (`wrk_docs/2025.11.07 - RPT - search_vs_hard_stage5.md`) with preliminary tables; narrative still pending.

## 10:25 - Stage 1 Reporting Pass
- Replaced Stage 5 draft with detailed methodology, findings, telemetry evidence, and risk sections.
- Document now captures seat coverage assumptions, deterministic setup rationale, and the zero-disagreement caveat.
- Next: add supporting appendices (telemetry sample, disagreement sanity plan) before moving to Stage 2 work.
## 10:40 - Stage 1 Wrap + Stage 2 Spec
- Added appendices to the Stage 5 report (telemetry sample + disagreement sanity plan) and refreshed timestamp.
- Authored `wrk_docs/2025.11.07 - SPEC - run_search_vs_mixed.md` outlining goals/requirements for the upcoming mixed-seat harness.
- Ready to start coding shared helpers and the new PowerShell driver next.
## 11:05 - Stage 2 Harness Implementation
- Added `tools/eval_shared.ps1` and refactored `tools/run_search_vs_hard.ps1` to reuse common helpers (think-limit args, match/compare runners, telemetry smoke helpers).
- Introduced `tools/run_search_vs_mixed.ps1` with mix-aware loops, optional seed-file mode, per-limit summaries, smoke scaffolds, and telemetry smoke reuse.
- Next: dry-run the new script with a tiny mix/seat count once cycles free, then document usage in README/CLI docs.
## 10:25 - Mixed-Seat Smoke
- Extended CLI to accept `s` (SearchLookahead) in `--match-mixed*` and reran small `shsh` mix batch via the new script.
- `tools/run_search_vs_mixed.ps1 -Mixes shsh -Count*=5 -ThinkLimitsMs 5000` produced artifacts in `designs/tuning/search_vs_mixed/2025-11-07_102024/` with sane averages per seat.
- Confirms harness wiring + folder structure; next up is README/CLI doc updates and optional telemetry smoke once counts scale.
## 10:50 - Docs + CLI polish
- Updated README and docs/CLI_TOOLS.md so `--match-mixed*` documents the new `e|n|h|s` mix tokens, and added references to both `run_search_vs_hard.ps1` and the new `run_search_vs_mixed.ps1` harnesses.
- Extended the CLI parser to treat `s` as SearchLookahead in both `--match-mixed` and `--match-mixed-file`, matching the new mixed-seat script needs.
- Will follow up with README links to the Stage 5/Stage 2 docs once the larger batch + analysis are ready.
## 11:00 - Mixed Telemetry Smoke
- Re-ran `run_search_vs_mixed.ps1` with `-TelemetrySmoke` to prove the new script captures timeout telemetry artifacts under `search_vs_mixed/2025-11-07_102736/.../telemetry_smoke.jsonl`.
- Smoke confirms north-seat `match-batch` fallback path works post-script refactor; ready to scale mixes/counts next.
## 11:10 - Disagreement Sanity Attempt
- Temporarily cleared `MDH_HARD_DETERMINISTIC` and ran two 20-seed `--compare-batch` sweeps (one default, one with `--hard-time-cap-ms 1`).
- Both CSVs (`tmp/compare_sanity.csv`, `tmp/compare_sanity_cap1.csv`) contained zero disagreement rows, so Search vs Hard still agree on card selection for this seed range.
- Logged the attempt + follow-up plan in the Stage 5 report appendix; next step is to widen the seed range or perturb Search limits if we need concrete disagreeing examples.
## 11:15 - Match-Mixed Telemetry Support
- Extended CLI `--match-mixed*` commands with `--telemetry-out` to export Hard telemetry directly; also reset the sink when requested.
- Updated `tools/run_search_vs_mixed.ps1` with a `-TelemetryOut` switch so each seat/limit writes NDJSON automatically, and verified via a 1-seed smoke.
- README + CLI docs now describe the new flags/scripts, and the Stage 5 report highlights that mixed sweeps no longer need dedicated smokes to capture telemetry.
## 11:25 - Mixed-Seat Analysis
- Built `tools/analyze_search_vs_mixed.py` to summarize per-seat penalties + telemetry stats from `designs/tuning/search_vs_mixed/2025-11-07_103451/` and cached results to `tmp/search_vs_mixed/2025-11-07_103451.json`.
- Updated the Stage 5 report with a mixed-seat section (shsh pilot table, telemetry notes, next steps).
- Full 800-match mixed batch (shsh) ran with `-TelemetryOut/-TelemetrySmoke`, confirming zero timeouts in regular runs and capturing NDJSON per seat/limit.
## 11:35 - Stage 6 Summary Outline
- Drafting the Stage 6 summary report and polishing Stage 5 doc to include data-artifact references.
## 11:45 - Additional Mix & Disagreement Sweep
- Ran nondeterministic `--compare-batch` sweeps (50 seeds, all seats). Still zero disagreements, even with Hard time caps removed; noted in appendix.
- Kicked off new mixed-seat run (`snhh`, 50 seeds/seat) with `-TelemetryOut`; summary cached at `tmp/search_vs_mixed/2025-11-07_153420.json` and referenced in the Stage 5 report.
## 11:55 - Disagreement Sweep #2
- Varied seeds and Hard budgets (time caps, cont boost tweaks) across all seats; `--compare-batch` still produced zero disagreements (CSV files in tmp/compare_sanity_*_rnd2.csv).
- Conclusion: need more drastic perturbations (e.g., stochastic Search) if disagreements are required, otherwise document the repeated zero result.
## 12:05 - Additional Mix (hssh)
- Ran `hssh` mix (Search west/south) with 50 seeds/seat at 5s cap via telemetry-enabled harness; artifacts at `designs/tuning/search_vs_mixed/2025-11-07_154005/`, metrics cached to `tmp/search_vs_mixed/2025-11-07_154005.json`.
- Stage 5 report now lists shsh, snhh, sshh, and hssh tables plus telemetry context.
## 12:15 - Targeted Tests
- Ran `cargo test -p hearts-app controller::tests::search_autoplay_records_think_limit` and `controller::tests::autoplay_timeout_records_fallback`; both green, covering the telemetry hooks touched throughout Stage 5 work.
