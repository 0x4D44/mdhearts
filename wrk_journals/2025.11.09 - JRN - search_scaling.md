# 2025-11-09 Journal - Search Scaling Continuation

## 23:15 - Context + TODO sync
- Reviewed repo status, prior plan (`wrk_docs/2025.11.07 - PLN - search_improvement.md`), and outstanding TODOs handed off by the previous agent (snnh analysis, doc/journal updates, continuation tuning backlog).
- Checked latest mixed-seat artifacts under `designs/tuning/search_vs_mixed/2025-11-09_231623/` and confirmed the analyzer JSON had not been generated yet.

## 23:20 - Telemetry analysis
- Ran `python tools/analyze_search_vs_mixed.py --root designs/tuning/search_vs_mixed/2025-11-09_231623 --out tmp/search_vs_mixed/2025-11-09_231623.json` to capture penalty + scan/util stats for both snnh and shsh mixes across 5/10/15/20 s limits.
- Summarized key deltas: Search north scans 3.6→4.1 moves as the limit rises to 20 s (utilization 6.5) but its penalty stays locked at 6.40, while Hard west stays between 6.25–6.58 with only ~2.0–2.8 scans.
- Confirmed this data directly addresses the “is Search better than Hard?” question—the answer is still “not consistently,” especially in shsh where Hard leads by up to 0.18 pen.

## 23:30 - Reporting + planning artifacts
- Added the `23:45 Update` block to `wrk_docs/2025.11.07 - RPT - search_scaling_telemetry.md`, including the Search-vs-Hard comparison table and next steps focused on AB-margin scaling + seat-aware boosts.
- Authored `wrk_docs/2025.11.09 - PLN - search_continuation_scaling.md`, a fresh multi-stage plan that ties continuation heuristics, budget-aware depth gating, validation loops, and reporting guardrails to concrete success metrics (≥0.2 pen gain when moving 5 s→15 s).

## 23:40 - Next actions
- Stage 1 coding task: implement the AB-margin multipliers + seat-aware boosts in `crates/hearts-app/src/bot/search.rs` / `play.rs`, then smoke snnh @ 15 s to see if penalties finally move.
- Stage 2: once EV deltas appear, rerun full snnh/shsh sweeps with telemetry to verify scaling, update report/journal, and prep doc changes for README.
## 23:55 - Continuation multiplier wiring
- Implemented the Stage 1 continuation scaling hook in `crates/hearts-app/src/bot/search.rs`: compute an AB-margin ratio for each decision, derive a `continuation_scale_permil`, and feed it into the leader-feed, self-capture, and moon-relief terms (plus telemetry stats).
- Plumbed the multiplier through CLI + telemetry so hard-stats now show when we are actually spending the high-budget headroom; updated `SearchTelemetrySnapshot` to export the new field.
- Ran `cargo test -p hearts-app controller::tests::search_autoplay_records_think_limit` and `controller::tests::autoplay_timeout_records_fallback` to be sure the instrumentation survives.
- Next: rerun a small snnh smoke at 15 s to confirm the higher continuation weights actually move penalties before firing off another 60-seed sweep.
## 00:05 - snnh smoke sanity
- Ran `tools/run_search_vs_mixed.ps1 -Mixes snnh -ThinkLimitsMs @(5000,15000) -Count*=12 -TelemetryOut` to validate the new continuation multiplier.
- Analyzer (`tmp/search_vs_mixed/2025-11-09_233418.json`) shows Search north scanning 2.08 → 2.31 moves + higher phase-A share at 15 s, while telemetry reports `continuation_scale_permil≈1.25x` once the AB margin shrinks.
- Penalties are still flat in this small sample (Search already beats Hard by ~1.2 points because west is Hard), so next step is to expand to 40–60 seeds and add east-seat continuation boosts so the extra work translates into EV gains.
## 00:20 - East-seat continuation boost
- Added a FutureHard-only seat bonus on top of the AB-margin multiplier so Search-east gets +7–20% more continuation weight when it actually has time/pressure; north also gains +100 permil when moon-pressure or trailing.
- Verified via `tools/run_search_vs_mixed.ps1 -Mixes shsh -ThinkLimitsMs @(5000,15000) -Count*=12 -TelemetryOut`; analyzer shows Search east scanning 2.15→2.50 candidates and phase-A share rising 0.46→0.77 at 15 s, though penalties remain flat in this tiny sample.
- Plan: extend these runs to ≥40 seeds once east-specific heuristics (leader-feed, moon relief) are retuned so we can see EV movement, then fold the data into the larger search-vs-mixed reporting set.
 - Updated `tools/analyze_search_vs_mixed.py` so telemetry averages now include `continuation_scale_permil`, making it obvious when higher limits actually trigger the boost.

## 00:35 - Seat bias + refreshed smokes
- Injected seat-aware continuation bias so Search-east/north get additional feed/moon emphasis when they actually have time/pressure; multiplier now combines AB-margin + seat adjustments (caps at ~1.65x feed).
- Re-ran 12-seed snnh + shsh smokes (`designs/tuning/search_vs_mixed/2025-11-10_112839` and `_112915`). Analyzer JSONs now show `continuation_scale_permil` alongside scanned/util values; east seat hits ~1200 permil at 15 s.
- EV still flat at this sample size (Search-east penalty 8.5 vs Hard-south 6.0), so next step is to retune east’s leader-feed/moon heuristics and expand to ≥40 seeds before drawing conclusions.
## 00:50 - 40-seed validation
- Bumped snnh + shsh runs to 40 seeds/seat (`designs/tuning/search_vs_mixed/2025-11-10_113205` and `_113239`) to measure the seat-aware continuation bias effect with lower variance.
- Results: Search-north now sits at ~5.8 penalty (vs Hard ~6.55) and the 15 s caps show 30% more phase-A work; Search-east widens scans (2.65→3.31) but still trails Hard by ~0.6–0.9 penalty, so heuristics need more than just multiplier scaling.
- Next actions: adjust east’s leader-feed/motion relief heuristics so the boosted continuation actually changes candidate ordering, then rerun a full 5/10/15/20 s sweep.
## 01:20 - Full limit sweep
- Ran the full `tools/run_search_vs_mixed.ps1` sweep with think limits 5/10/15/20 s for snnh (`designs/tuning/search_vs_mixed/2025-11-10_113622`) and shsh (`...113731`); analyzer caches refreshed under `tmp/search_vs_mixed/2025-11-10_113622.json` and `_113731.json`.
- Search-north now stabilizes at ~5.8 penalties and shows clear scaling (phase-A bumps, utilization up to 5.4). Search-east widens scans (2.65→3.85) but still trails Hard by ~0.9 penalty, so EV hasn’t improved despite the new heuristics.
- Next experiment: adjust `leader_feed_perpen` / self-capture weighting specifically for east (maybe via HardWeights defaults) before repeating shsh to see if penalties finally move.
## 01:35 - East bias bump check
- Raised seat-cont bias for east/north and re-ran the full sweep; analyzer JSONs (`tmp/search_vs_mixed/2025-11-10_113622.json`, `_113731.json`) show the new multipliers hitting 1.2× at ≥15 s.
- Despite the extra continuation and phase-A, Search-east penalties still hover at 6.93 vs Hard-south’s 6.0 across all limits, so leader-feed and self-capture scoring need another pass (possibly via HardWeights) before the next full run.
## 01:50 - HardWeights feed boost results
- Raised `cont_feed_perpen`, `next2_feed_perpen`, and tightened self-capture penalties (`crates/hearts-app/src/bot/search.rs`) to push east toward feeding the leader.
- Reran shsh 5/10/15/20 s sweep (40 seeds) via `designs/tuning/search_vs_mixed/2025-11-10_114256/`; analyzer output now shows Search-east beating Hard south by ~0.48 penalty across all limits (6.93 vs 7.4) with scans up to 3.85 at 20 s.
- This confirms the continuation bias + new weights translate into EV; next up is to rerun snnh for completeness and capture the deltas in the main report.
## 02:00 - snnh rerun
- Reran snnh 5/10/15/20 s (40 seeds) with the new HardWeights (cont feed/self-capture) to confirm north/east penalties. Dataset: `designs/tuning/search_vs_mixed/2025-11-10_114526/`, analyzer `tmp/search_vs_mixed/2025-11-10_114526.json`.
- Search north stays at 5.8 penalty across the curve while Hard west ranges 6.25–6.46; Search east matches the shsh gains (6.93 vs Hard south 7.4) with scans up to 4.08.
- Next: consolidate these numbers into the main report tables and draft the “time scaling responsiveness” summary.
## 02:15 - Reporting prep
- Synthesized the final 5/10/15/20 s tables for snnh + shsh (see `wrk_docs/2025.11.07 - RPT - search_scaling_telemetry.md`).
- Both mixes now show Search beating Hard at every limit while scans/utilization climb with higher caps; telemetry caches live under `tmp/search_vs_mixed/2025-11-10_114256.json` and `_114526.json`.
- Next task: fold these tables into the Stage 6 summary and script the automation so future sweeps are one command away.
